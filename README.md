# GifMaker

一个功能强大的 GIF 动画制作工具，支持批量图片处理、裁剪、预览和导出。

## 功能特性

### 核心功能
- **批量图片导入**：支持选择单张或多张图片文件，或直接导入整个目录
- **智能排序**：支持拖拽调整图片顺序，右键菜单提供复制、剪切、粘贴、删除等操作
- **实时预览**：网格布局展示所有图片，支持缩放查看
- **GIF 生成**：可自定义每帧持续时间、循环次数、输出尺寸
- **裁剪功能**：支持单张或多张图片的统一裁剪，提供多种预设比例
- **裁剪预览**：实时预览裁剪效果，支持拖动调整裁剪框
- **裁剪导航**：支持在多张图片之间切换，保持预览模式

### 高级功能
- **多选操作**：支持 Shift 范围选择、Ctrl 多选
- **历史记录**：完整的撤销/重做功能
- **裁剪比例锁定**：支持自由比例、锁定当前比例、预设比例（1:1、16:9、4:3、3:2、2:3）
- **预览窗口**：独立的 GIF 预览窗口，支持播放控制、帧导航、缩放调节
- **智能缓存**：PhotoImage 对象缓存机制，防止垃圾回收导致的显示问题
- **拖动阈值**：图片拖动需要移动一定距离才生效，防止误操作

### 用户界面
- **现代化设计**：基于 Tkinter 的友好图形界面
- **响应式布局**：窗口大小自适应，支持滚动查看
- **快捷键支持**：
  - Ctrl+A：全选图片
  - Ctrl+Z：撤销
  - Ctrl+Y：重做
  - Ctrl+S：保存裁剪
  - 鼠标滚轮：缩放预览
  - Ctrl+滚轮：滚动查看

## 系统要求

- Python 3.8+
- Windows / macOS / Linux
- 依赖库：Pillow

## 安装

### 1. 克隆项目
```bash
git clone https://github.com/yourusername/GifMaker.git
cd GifMaker
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行程序
```bash
python GifMaker.py
```

## 使用指南

### 基本操作流程

1. **导入图片**
   - 点击 📁 按钮选择单张或多张图片
   - 点击 📂 按钮导入整个目录
   - 图片会以网格形式显示在预览区域

2. **调整顺序**
   - 拖拽图片到目标位置
   - 使用右键菜单的复制、剪切、粘贴功能
   - Shift+点击进行范围选择
   - Ctrl+点击进行多选

3. **裁剪图片（可选）**
   - 选中要裁剪的图片
   - 点击右键菜单中的"进入裁剪模式"
   - 在裁剪窗口中调整选框
   - 支持锁定比例、预设比例（自由、锁定、原始、1:1、16:9、4:3、3:2、2:3）
   - 可使用裁剪预览功能实时查看裁剪效果
   - 支持导航功能（第一张、上一张、下一张、最后一张）切换图片
   - 点击 ✅ 确认裁剪设置

4. **设置 GIF 参数**
   - 调整每帧持续时间（50-2000ms）
   - 设置循环次数（0 表示无限循环）
   - 可选：调整输出尺寸
   - 可选：启用 GIF 优化

5. **生成 GIF**
   - 点击 🎬 按钮预览 GIF 动画
   - 在预览窗口中调整播放速度、查看各帧
   - 点击 💾 保存裁剪结果到文件
   - 点击"生成"按钮导出最终 GIF

### 裁剪功能详解

#### 单张图片裁剪
1. 选中单张图片
2. 进入裁剪模式
3. 手动调整选框或输入精确坐标
4. 可使用裁剪预览功能实时查看效果
5. 点击 ✅ 确认裁剪

#### 多张图片统一裁剪
1. 选中多张图片（Shift 或 Ctrl 多选）
2. 进入裁剪模式
3. 系统自动选择最小的图片作为基准
4. 调整裁剪区域，所有图片应用相同裁剪
5. 可使用导航功能在图片之间切换
6. 点击 ✅ 确认裁剪

#### 裁剪比例选项
- **自由**：不受限制，任意调整
- **锁定**：保持当前选框的宽高比
- **原始**：使用图片的原始宽高比
- **1:1**：正方形
- **16:9**：宽屏视频比例
- **4:3**：传统显示器比例
- **3:2**：经典相机比例
- **2:3**：竖屏相机比例

#### 裁剪预览功能
- **实时预览**：在裁剪模式下可实时预览裁剪效果
- **拖动调整**：在预览模式下可拖动裁剪框，实时查看效果
- **保持预览**：切换图片时保持预览模式，方便批量裁剪
- **导航功能**：支持第一张、上一张、下一张、最后一张导航

### 预览窗口功能

- **播放控制**：▶/⏸ 播放/暂停
- **帧导航**：⏮ 第一帧、◀ 上一帧、▶ 下一帧、⏭ 最后一帧
- **缩放控制**：🔍+ 放大、🔍- 缩小、🔄 重置、适应窗口
- **实时调整**：可动态修改每帧持续时间
- **进度条**：拖动进度条快速跳转到指定帧

## 项目结构

```
GifMaker/
├── GifMaker.py              # 主程序入口
├── build_exe.py             # 打包脚本
├── GifMaker.spec            # PyInstaller 配置
├── requirements.txt         # 依赖列表
├── README.md                # 项目文档
├── function/                # 功能模块
│   ├── __init__.py
│   ├── file_manager.py      # 文件管理（导入、导出、排序）
│   ├── image_utils.py       # 图像处理工具
│   ├── crop_backup.py       # 裁剪备份
│   ├── history_manager.py   # 历史记录管理
│   ├── gif_operations.py    # GIF 生成和优化
│   ├── list_operations.py   # 列表操作（复制、剪切、粘贴、删除）
│   ├── preview.py           # 预览功能
│   ├── ui_operations.py     # UI 操作和辅助函数
│   └── photo_cropper.py     # 照片裁剪器
├── gui/                     # 图形界面
│   ├── __init__.py
│   ├── main_window.py       # 主窗口
│   ├── crop_gui.py          # 裁剪对话框
│   └── gifpreview_gui.py    # 预览窗口
└── icons/                   # 图标资源
    ├── gif.png
    ├── photo.png
    └── photos.png
```

## 技术特点

### 架构设计
- **模块化设计**：功能模块与界面分离，便于维护和扩展
- **状态管理**：使用 HistoryManager 实现完整的撤销/重做功能
- **事件驱动**：基于 Tkinter 事件系统，响应迅速

### 性能优化
- **图片缓存**：PhotoImage 对象缓存，避免重复加载
- **延迟渲染**：使用 after 方法确保 UI 渲染完成后再执行耗时操作
- **智能缩放**：根据缩放方向选择不同的插值算法（放大用 LANCZOS，缩小用 BILINEAR）

### 用户体验
- **实时反馈**：所有操作都有视觉反馈
- **错误处理**：完善的异常捕获和用户提示
- **智能提示**：鼠标悬停显示功能说明

## 常见问题

### Q: 生成的 GIF 文件太大怎么办？
A: 可以尝试以下方法：
1. 减少图片数量
2. 降低每帧持续时间
3. 调整输出尺寸（缩小尺寸）
4. 启用 GIF 优化选项

### Q: 如何批量裁剪多张图片？
A: 选中多张图片后进入裁剪模式，系统会自动选择最小的图片作为基准，所有图片将应用相同的裁剪区域。

### Q: 预览窗口中的图片显示不清晰？
A: 可以使用缩放功能放大查看，或点击"适应窗口"按钮。

### Q: 如何调整图片顺序？
A: 可以拖拽图片到目标位置，或使用右键菜单的复制、剪切、粘贴功能。

### Q: 支持哪些图片格式？
A: 支持 PIL/Pillow 支持的所有格式，包括 JPG、PNG、BMP、GIF 等。

## 开发说明

### 添加新功能
1. 在 `function/` 目录下创建或修改功能模块
2. 在 `gui/` 目录下更新界面代码
3. 确保添加适当的错误处理和用户提示

### 代码规范
- 使用 UTF-8 编码
- 遵循 PEP 8 代码风格
- 添加必要的文档字符串
- 使用类型提示（Type Hints）

### 测试
建议测试以下场景：
- 导入不同格式的图片
- 批量操作（多选、拖拽）
- 裁剪功能（单张、多张、不同比例）
- GIF 生成和预览
- 撤销/重做功能
- 边界情况（空列表、超大图片等）

## 打包发布

使用 PyInstaller 打包为可执行文件：

```bash
python build_exe.py
```

打包后的可执行文件位于 `dist/` 目录。

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v1.1.0
- 新增裁剪预览功能，支持实时预览裁剪效果
- 新增裁剪导航功能，支持第一张、上一张、下一张、最后一张
- 优化裁剪界面按钮布局，统一按钮样式
- 优化主界面拖动功能，添加拖动阈值防止误操作
- 修复路径显示斜杠不统一的问题
- 修复选择单个文件时导航按钮报错的问题
- 优化图片属性显示，移除模式信息

### v1.0.0
- 初始版本发布
- 支持基本的 GIF 制作功能
- 实现裁剪、预览、历史记录等高级功能